<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VTU 7th Sem Result 2026</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background: #5865F2; background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%); }
        .glass-panel { background: rgba(255, 255, 255, 0.98); border-radius: 1rem; box-shadow: 0 10px 40px -10px rgba(0,0,0,0.2); }
        
        /* Table Styles */
        .table-header { background-color: #1e293b; color: #ffffff; }
        .rank-1 { color: #d97706; font-size: 1.2rem; } /* Gold */
        .rank-2 { color: #64748b; font-size: 1.1rem; } /* Silver */
        .rank-3 { color: #b45309; font-size: 1.1rem; } /* Bronze */
        
        /* Status Colors */
        .status-P { color: #16a34a; font-weight: 700; background: #dcfce7; padding: 2px 8px; border-radius: 4px; }
        .status-F { color: #dc2626; font-weight: 700; background: #fee2e2; padding: 2px 8px; border-radius: 4px; }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center py-8 px-4 text-gray-800">

    <div class="text-center mb-8">
        <h1 class="text-4xl font-black text-white drop-shadow-md tracking-tight">üéì VTU RESULT PORTAL</h1>
        <p class="text-indigo-100 mt-2 font-medium">7th Semester | 2022 Scheme</p>
    </div>

    <div class="flex bg-white/20 p-1.5 rounded-full backdrop-blur-md border border-white/30 shadow-lg mb-8">
        <button onclick="switchView('home')" id="nav-home" class="px-6 py-2 rounded-full font-bold text-sm transition-all bg-white text-indigo-600 shadow-sm">
            üîç Check Result
        </button>
        <button onclick="switchView('leaderboard')" id="nav-lead" class="px-6 py-2 rounded-full font-bold text-sm text-white hover:bg-white/10 transition-all">
            üèÜ Leaderboard
        </button>
    </div>

    <div id="main-container" class="w-full max-w-6xl">
        
        <div id="view-home" class="flex flex-col md:flex-row gap-6 items-start justify-center">
            
            <div class="w-full md:w-1/3 glass-panel p-8 animate-fade-in-up">
                <div class="mb-6">
                    <h2 class="text-xl font-bold text-gray-800 border-b pb-2">Student Details</h2>
                </div>
                
                <form id="resultForm" class="space-y-5">
                    <div>
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-1">USN</label>
                        <input type="text" name="usn" placeholder="1DB22CS & 1DB23CS only" class="w-full bg-gray-50 border border-gray-300 p-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 font-mono font-bold text-gray-700 uppercase" required>
                    </div>
                    
                    <div>
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Captcha</label>
                        <div class="flex gap-2">
                            <input type="text" name="captcha" placeholder="Code" class="flex-1 min-w-0 bg-gray-50 border border-gray-300 p-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 font-mono font-bold text-gray-700" required>
                            <img id="captchaImg" src="/get_captcha" onclick="refreshCaptcha()" class="w-28 h-[50px] object-fill rounded border border-gray-300 cursor-pointer hover:opacity-80 shadow-sm bg-white" title="Click to Refresh">
                        </div>
                    </div>

                    <button type="submit" id="subBtn" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white p-3.5 rounded-lg font-bold shadow-lg transition-all transform active:scale-95">
                        GET RESULT
                    </button>
                </form>
            </div>

            <div id="result-card" class="hidden w-full md:w-2/3 glass-panel p-8 relative min-h-[450px] animate-fade-in-up">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center border-b border-gray-200 pb-5 mb-6">
                    <div>
                        <h2 id="res-name" class="text-3xl font-black text-gray-800 tracking-tight">STUDENT NAME</h2>
                        <span id="res-usn" class="font-mono text-gray-500 font-medium">1DB21CS000</span>
                    </div>
                    <span id="res-class" class="mt-2 md:mt-0 bg-emerald-100 text-emerald-800 text-xs font-bold px-4 py-1.5 rounded-full border border-emerald-200 uppercase tracking-wide">
                        Distinction
                    </span>
                </div>

                <div class="grid grid-cols-3 gap-4 mb-8">
                    <div class="bg-emerald-500 text-white p-4 rounded-xl text-center shadow-lg transform hover:-translate-y-1 transition">
                        <div class="text-xs font-bold opacity-80 uppercase tracking-widest">SGPA</div>
                        <div id="res-sgpa" class="text-4xl font-black mt-1">0.00</div>
                        <div id="res-perc" class="text-xs font-medium mt-1 opacity-90">0%</div>
                    </div>
                    <div class="bg-blue-600 text-white p-4 rounded-xl text-center shadow-lg transform hover:-translate-y-1 transition">
                        <div class="text-xs font-bold opacity-80 uppercase tracking-widest">Total Marks</div>
                        <div id="res-marks" class="text-4xl font-black mt-1">0</div>
                        <div class="text-xs opacity-90 mt-1">out of 700</div>
                    </div>
                    <div class="bg-amber-500 text-white p-4 rounded-xl text-center shadow-lg transform hover:-translate-y-1 transition">
                        <div class="text-xs font-bold opacity-80 uppercase tracking-widest">Batch Rank</div>
                        <div id="res-rank" class="text-4xl font-black mt-1">#0</div>
                        <div class="text-xs opacity-90 mt-1">Class Position</div>
                    </div>
                </div>

                <div class="overflow-hidden rounded-lg border border-gray-200">
                    <table class="w-full text-sm">
                        <thead class="bg-gray-50 text-gray-500 font-bold uppercase text-xs border-b border-gray-200">
                            <tr>
                                <th class="p-3 text-left">Code</th>
                                <th class="p-3 text-left">Subject Name</th>
                                <th class="p-3 text-center">Marks</th>
                                <th class="p-3 text-right">Result</th>
                            </tr>
                        </thead>
                        <tbody id="subject-body" class="divide-y divide-gray-100 bg-white">
                            </tbody>
                    </table>
                </div>
            </div>

            <div id="placeholder-card" class="w-full md:w-2/3 glass-panel p-12 flex flex-col items-center justify-center text-center text-gray-400 min-h-[450px]">
                <div class="bg-gray-50 p-6 rounded-full mb-4">
                    <svg class="w-12 h-12 text-indigo-200" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                </div>
                <h3 class="font-bold text-xl text-gray-600">Ready to Fetch</h3>
                <p class="text-sm mt-1">Enter USN and Captcha to view detailed scorecard</p>
            </div>
        </div>

        <div id="view-leaderboard" class="hidden mt-4">
            <div class="bg-white rounded-xl shadow-2xl overflow-hidden max-w-6xl mx-auto">
                
                <div class="p-8 text-center bg-white border-b border-gray-100">
                    <h2 class="text-2xl font-black text-amber-500 tracking-tight flex items-center justify-center gap-2">
                        <span>üëë</span> Top Performers
                    </h2>
                    <p class="text-gray-400 text-xs uppercase tracking-widest mt-1">Computer Science Department</p>
                </div>

                <div class="bg-gray-50 p-4 border-b border-gray-200 flex justify-between items-center gap-4">
                    <div class="relative flex-1 max-w-md">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                        </div>
                        <input type="text" id="searchInput" onkeyup="filterTable()" placeholder="Search by USN or Name..." class="w-full pl-10 pr-4 py-2 bg-white border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 text-sm">
                    </div>
                    <button onclick="document.getElementById('searchInput').value=''; filterTable()" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded text-sm font-bold transition shadow-sm">
                        √ó Clear
                    </button>
                </div>

                <div class="overflow-x-auto">
                    <table class="w-full text-left border-collapse">
                        <thead class="table-header uppercase text-xs font-bold tracking-wider">
                            <tr>
                                <th class="p-4 text-center w-24">Rank</th>
                                <th class="p-4 w-40">USN</th>
                                <th class="p-4">Name</th>
                                <th class="p-4 text-center cursor-pointer hover:bg-slate-700 transition" onclick="toggleSort('marks')">
                                    Marks <span id="icon-marks">‚ñº</span>
                                </th>
                                <th class="p-4 text-center cursor-pointer hover:bg-slate-700 transition" onclick="toggleSort('sgpa')">
                                    SGPA <span id="icon-sgpa">‚ñº</span>
                                </th>
                                <th class="p-4 text-center text-amber-400">Percentage</th>
                            </tr>
                        </thead>
                        <tbody id="lb-body" class="text-sm font-medium text-gray-700 bg-white divide-y divide-gray-100">
                            </tbody>
                    </table>
                </div>
            </div>
        </div>

    </div>

    <div class="mt-12 text-indigo-200 text-xs font-medium">
        Designed & Developed by Astitva & Ananya C Y
    </div>

    <script>
        let sortConfig = { field: 'marks', order: 'desc' };
        let allData = []; // Store data for client-side search filtering

        function switchView(view) {
            if(view === 'home') {
                $('#view-home').removeClass('hidden').addClass('flex');
                $('#view-leaderboard').addClass('hidden');
                
                // Update Pill Styles
                $('#nav-home').addClass('bg-white text-indigo-600 shadow-sm').removeClass('text-white hover:bg-white/10');
                $('#nav-lead').removeClass('bg-white text-indigo-600 shadow-sm').addClass('text-white hover:bg-white/10');
            } else {
                $('#view-home').addClass('hidden').removeClass('flex');
                $('#view-leaderboard').removeClass('hidden');
                
                // Update Pill Styles
                $('#nav-lead').addClass('bg-white text-indigo-600 shadow-sm').removeClass('text-white hover:bg-white/10');
                $('#nav-home').removeClass('bg-white text-indigo-600 shadow-sm').addClass('text-white hover:bg-white/10');
                
                loadLeaderboard();
            }
        }

        function refreshCaptcha() {
            $('#captchaImg').attr('src', '/get_captcha?' + new Date().getTime());
        }

        $('#resultForm').submit(function(e) {
            e.preventDefault();
            const btn = $('#subBtn');
            btn.text('CONNECTING...').prop('disabled', true).addClass('opacity-75 cursor-not-allowed');

            $.post('/fetch_result', $(this).serialize(), function(r) {
                btn.text('GET RESULT').prop('disabled', false).removeClass('opacity-75 cursor-not-allowed');
                
                if(r.status === 'success') {
                    const d = r.data;
                    $('#res-name').text(d.name);
                    $('#res-usn').text(d.usn); // Added USN display
                    $('#res-class').text(d.class_result);
                    $('#res-sgpa').text(d.sgpa);
                    $('#res-perc').text(d.percentage);
                    $('#res-marks').text(d.total_marks);
                    $('#res-rank').text('#' + d.rank);

                    let rows = '';
                    d.subjects.forEach(s => {
                        let statusHTML = s.result === 'P' 
                            ? '<span class="status-P">P</span>' 
                            : '<span class="status-F">F</span>';
                        
                        rows += `
                            <tr class="hover:bg-gray-50 transition">
                                <td class="p-3 font-mono text-gray-500 font-bold">${s.code}</td>
                                <td class="p-3 text-gray-800 font-semibold">${s.name}</td>
                                <td class="p-3 text-center font-bold text-gray-700">${s.total}</td>
                                <td class="p-3 text-right">${statusHTML}</td>
                            </tr>`;
                    });
                    $('#subject-body').html(rows);
                    $('#placeholder-card').addClass('hidden');
                    $('#result-card').removeClass('hidden').hide().fadeIn();
                    refreshCaptcha();
                } else {
                    alert(r.message);
                    if(r.message.includes("Captcha")) refreshCaptcha();
                }
            });
        });

        function toggleSort(field) {
            if (sortConfig.field === field) {
                sortConfig.order = sortConfig.order === 'desc' ? 'asc' : 'desc';
            } else {
                sortConfig.field = field;
                sortConfig.order = 'desc';
            }
            loadLeaderboard();
        }

        function loadLeaderboard() {
            $('#lb-body').html('<tr><td colspan="6" class="p-8 text-center text-gray-400 italic">Fetching data from server...</td></tr>');
            
            $.get(`/leaderboard?sort=${sortConfig.field}&order=${sortConfig.order}`, function(r) {
                allData = r.data; // Save for search
                renderTable(allData);
            });
        }

        function renderTable(data) {
            // Update Sort Icons
            $('#icon-marks').text(sortConfig.field === 'marks' ? (sortConfig.order === 'asc' ? '‚ñ≤' : '‚ñº') : '‚ñº').css('opacity', sortConfig.field === 'marks' ? 1 : 0.3);
            $('#icon-sgpa').text(sortConfig.field === 'sgpa' ? (sortConfig.order === 'asc' ? '‚ñ≤' : '‚ñº') : '‚ñº').css('opacity', sortConfig.field === 'sgpa' ? 1 : 0.3);

            let html = '';
            if(data.length === 0) {
                html = '<tr><td colspan="6" class="p-8 text-center text-gray-400">No records found.</td></tr>';
            } else {
                data.forEach(s => {
                    let rankDisplay = `#${s.rank}`;
                    let rowClass = "hover:bg-slate-50 transition border-b border-gray-100";
                    
                    // Top 3 Styling
                    if(s.rank === 1) rankDisplay = '<span class="rank-1">ü•á</span>';
                    if(s.rank === 2) rankDisplay = '<span class="rank-2">ü•à</span>';
                    if(s.rank === 3) rankDisplay = '<span class="rank-3">ü•â</span>';
                    if(s.rank <= 3) rowClass += " bg-yellow-50/30";

                    // Column Highlighting based on sort
                    let markClass = sortConfig.field === 'marks' ? "text-blue-700 font-black" : "text-blue-600 font-bold";
                    let sgpaClass = sortConfig.field === 'sgpa' ? "text-emerald-700 font-black" : "text-emerald-600 font-bold";

                    html += `
                        <tr class="${rowClass}">
                            <td class="p-4 text-center font-bold text-gray-600">${rankDisplay}</td>
                            <td class="p-4 font-mono font-bold text-gray-800">${s.usn}</td>
                            <td class="p-4 font-bold text-gray-700 uppercase">${s.name}</td>
                            <td class="p-4 text-center ${markClass}">${s.total_marks}</td>
                            <td class="p-4 text-center ${sgpaClass}">${s.sgpa}</td>
                            <td class="p-4 text-center font-bold text-amber-500">${s.percentage}</td>
                        </tr>`;
                });
            }
            $('#lb-body').html(html);
        }

        function filterTable() {
            const term = document.getElementById('searchInput').value.toLowerCase();
            const filtered = allData.filter(item => 
                item.name.toLowerCase().includes(term) || 
                item.usn.toLowerCase().includes(term)
            );
            renderTable(filtered);
        }
    </script>
</body>
</html>